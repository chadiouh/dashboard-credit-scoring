import shap
import pandas as pd
import json

# modèle et X_train doivent être déjà chargés
explainer = shap.TreeExplainer(model)
shap_values = explainer.shap_values(X_train)

# Si shap_values est une liste (cas LightGBM), prendre la classe 1
if isinstance(shap_values, list) and len(shap_values) == 2:
    shap_values = shap_values[1]

# Calcul de la moyenne absolue
mean_shap = abs(shap_values).mean(axis=0)
shap_importance = dict(zip(X_train.columns, mean_shap))

# Export
with open("models/global_shap_importances.json", "w") as f:
    json.dump(shap_importance, f)